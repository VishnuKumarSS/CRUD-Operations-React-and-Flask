<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.2.5 and Furo 2023.09.10 -->
        <title>flask_app.views - Admin Dashboard - Flask 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Admin Dashboard - Flask 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Admin Dashboard - Flask 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Vishnu - User Management Admin Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../views.html">Views module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../createsuperuser.html">Create Superuser module</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for flask_app.views</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The module ``restapi.py`` created using flask_restful to perform all the restful api standard CRUD operations and Login system with the authentication.</span>

<span class="sd">The restapi module allows the us to perform the Create, Read, Update and Delete operations using the request methods like ``POST, GET, PUT, DELETE``. </span>
<span class="sd">There are methods to perform login and logout operation for normal and google authenticated user from firebase. </span>

<span class="sd">Restapi module consist of several methods to perform CRUD and to login and logout the users.</span>
<span class="sd">It requires parameters of string for SearchUser method to perform the appropriate actions.</span>
<span class="sd">This module requires ``flask, flask_restful, flask_bcrypt, flask_session, flask_cors`` be </span>
<span class="sd">installed within the python environment where we are running this module.</span>

<span class="sd">This file can also be imported as a module and contains the following:</span>
<span class="sd">    Classes:</span>
<span class="sd">        * ``ReactGoogleSignin`` - </span>
<span class="sd">                ReactGoogleSignin class inheriting from Resource class from the flask_restful module used to create a user with google authenticated data coming from react application on the frontend.\n</span>
<span class="sd">                It will Create a user if not registered or Logs In the user if already registered by using the post method.\n</span>
<span class="sd">                ``POST``: </span>
<span class="sd">                    Post method will get the user information like email, fullname, google_id from the frontend react application and stores the data on the database with the if the user data is not there in database, Otherwise it just logs in the user by creating session id called ``created_user_id``.</span>
<span class="sd">        * ``AllUsers`` -</span>
<span class="sd">                AllUsers class inheriting from Resource class of the flask_restful module used to get all the available users and users data from the tables ``users`` and ``user_data`` on the database.\n</span>
<span class="sd">                ``GET``:</span>
<span class="sd">                    The get method of class AllUsers will return all the users and users data stored in the database.</span>
<span class="sd">        * ``SearchUser`` - </span>
<span class="sd">                SearchUser class inheriting from Resource class of the flask_restful module needs username of string type from the ``user_data`` to be passed in the url route for performing actions like searching, deleting and updating a particular user.</span>
<span class="sd">                The table ``user_data`` should have the username of string type passed as a parameter on the url route to perform all the actions on the methods namely ``get, delete, put``.</span>
<span class="sd">                Otherwise the actions will not be performed.\n</span>
<span class="sd">                ``GET``:</span>
<span class="sd">                    The get method of SearchUser class will search for the user and returns that user&#39;s details in a dictionary format if exist, otherwise it will abort the request with User Not found message.</span>
<span class="sd">                ``DELETE``:</span>
<span class="sd">                    The delete method of SearchUser class will delete the particular user and particular user&#39;s data if the username exist, otherwise abort the request.</span>
<span class="sd">                    It will not delete when there is session id of currently LoggedIn user. Because we cannot delete when we are already LoggedIn.</span>
<span class="sd">                ``PUT``:</span>
<span class="sd">                    The put method of SearchUser class will get the username of string type, if any matching user exist then it can update that particular user&#39;s data otherwise it cannot perform action.</span>
<span class="sd">        * ``CreateUser`` - </span>
<span class="sd">                CreateUser class inheriting from Resource class of the flask_restful module used to create a particular user and to store all the data on the ``users`` and  table on the database and on the firebase for later authentication on the ``Login`` class.\n</span>
<span class="sd">                ``POST``:</span>
<span class="sd">                    The post method of the CreateUser class is used to create a user and store it on the database ``users`` table if not exist and on the firebase for email and password login. </span>
<span class="sd">        * ``AddUserData`` - </span>
<span class="sd">                AddUserData class inheriting from Resource class of the flask_restful module used to add data for the created user on the ``CreateUser`` class using the created session id from the CreateUser class.\n</span>
<span class="sd">                ``POST``:</span>
<span class="sd">                    The post method of AddUserData is used to add user information to the current user and store it on the database.</span>
<span class="sd">                    This method exactly add up the data to the recently created user or logged in user, otherwise it cannot perform any action and will abort.</span>
<span class="sd">        * ``Login`` - </span>
<span class="sd">                Login class inheriting from Resource class of the flask_restful module used to login the ``user created by normal method`` not by google authenticated method. It can only login the user with data stored on database and the firebase.\n</span>
<span class="sd">                ``POST``:</span>
<span class="sd">                    The post method of Login class is used to login a particular user by verifying it on the database and the firebase for authentication.</span>

<span class="sd">        * ``Logout`` - </span>
<span class="sd">                Logout class inheriting from Resource class of the flask_restful module used to logout a particular user by using the available session id. If there is not session id then it will abort the request.\n</span>
<span class="sd">                ``POST``:</span>
<span class="sd">                    The post method of Logout class will logout if any users are currently logged in. Which is identified by using the available session id.</span>
<span class="sd">                    It basically removes/pops the session id from the cookie so that the particular will get logged out.</span>

<span class="sd">        * ``CurrentUser`` -</span>
<span class="sd">                CurrentUser class inheriting from Resource class of the flask_restful module used to get all the data of a currently loggedin user, which is identified by using the session id.\n</span>
<span class="sd">                ``GET``:</span>
<span class="sd">                    This get method of CurrentUser class will return the currently logged in user data from both tables namely ``users`` and ``user_data`` by using the session id called ``created_user_id``, Otherwise will abort the request.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">from</span> <span class="nn">flask_restful</span> <span class="kn">import</span> <span class="n">Resource</span><span class="p">,</span> <span class="n">reqparse</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">marshal_with</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Users</span><span class="p">,</span> <span class="n">UserData</span><span class="p">,</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span> <span class="c1"># this session will be stored on the server side if we have Server sided session enabled...server_session = Session(app)</span>
<span class="kn">from</span> <span class="nn">.authentication</span> <span class="kn">import</span> <span class="n">auth</span>
<span class="kn">from</span> <span class="nn">.app</span> <span class="kn">import</span> <span class="n">bcrypt</span>


<span class="n">create_user_req</span> <span class="o">=</span> <span class="n">reqparse</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>
<span class="n">create_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Email is required.&#39;</span><span class="p">)</span>
<span class="n">create_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Full name is needed.&#39;</span><span class="p">)</span>
<span class="n">create_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;password is required.&#39;</span><span class="p">)</span>

<span class="n">add_user_data_req</span> <span class="o">=</span> <span class="n">reqparse</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>
<span class="n">add_user_data_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Username is needed.&#39;</span><span class="p">)</span>
<span class="n">add_user_data_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;userage&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Age is needed.&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">add_user_data_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;usercity&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;City is needed.&#39;</span><span class="p">)</span>
<span class="n">add_user_data_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;usertype&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;UserType is needed.&#39;</span><span class="p">)</span>


<span class="n">update_user_req</span> <span class="o">=</span> <span class="n">reqparse</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;userage&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;usercity&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">update_user_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;usertype&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>


<span class="n">user_login_req</span> <span class="o">=</span> <span class="n">reqparse</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>
<span class="c1"># user_login_req.add_argument(&#39;username&#39;, type=str, required=True, help=&#39;Username is needed.&#39;, )</span>
<span class="n">user_login_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Email is needed.&#39;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">user_login_req</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Password is Required.&#39;</span><span class="p">,</span> <span class="p">)</span>


<span class="n">create_user_field</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;fullname&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">add_user_data_field</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;userage&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
    <span class="s1">&#39;usercity&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
    <span class="s1">&#39;usertype&#39;</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">String</span>
<span class="p">}</span>


<div class="viewcode-block" id="ReactGoogleSignin">
<a class="viewcode-back" href="../../views.html#flask_app.views.ReactGoogleSignin">[docs]</a>
<span class="k">class</span> <span class="nc">ReactGoogleSignin</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ReactGoogleSignin class inheriting from Resource class of the flask_restful module will  used to create a user with google authenticated data coming from react application on the frontend.\n</span>
<span class="sd">    It will Create a user if not registered or Logs In the user if already registered by using the post method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ReactGoogleSignin.post">
<a class="viewcode-back" href="../../views.html#flask_app.views.ReactGoogleSignin.post">[docs]</a>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Post method of class ReactGoogleSignin will get the user information like email, fullname, google_id from the frontend react application and stores the data on the database with the if the user data is not there in database, Otherwise it just logs in the user by creating session id called ``created_user_id``.</span>
<span class="sd">        </span>
<span class="sd">        :return: the user is created or logged in or not</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># below we are getting the data&#39;s directly from the frontend. So inside the []  make sure to type the spelling appropriately to the frontend returned data.</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">google_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;googleId&#39;</span><span class="p">]</span>
        <span class="c1"># or</span>
        <span class="c1"># we can do what we did in login class.</span>

        <span class="c1"># check_table = db.engine.execute(&#39;select * from google_user_data&#39;)</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="p">,</span> <span class="n">fullname</span> <span class="o">=</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">google_id</span> <span class="o">=</span> <span class="n">google_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="c1"># try:</span>
            <span class="n">google_user</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span>
                <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">fullname</span><span class="o">=</span><span class="n">fullname</span><span class="p">,</span> <span class="n">google_id</span><span class="o">=</span><span class="n">google_id</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">google_user</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;created_user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">google_user</span><span class="o">.</span><span class="n">id</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Google User Created...&#39;</span><span class="p">})</span>
        <span class="c1"># except:</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># logged_in_user = Users.query.filter_by(google_id=google_id).first()</span>
            <span class="n">logged_in_user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from users where google_id=&#39;</span><span class="si">{</span><span class="n">google_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">logged_in_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Unauthorized user...Not found.&quot;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">session</span><span class="p">[</span><span class="s1">&#39;created_user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logged_in_user</span><span class="o">.</span><span class="n">id</span>
            
            <span class="c1"># The response should be (&#39;ibfdfnd78fd78fdbhfbhd&#39;, &#39;email@gmail.com&#39;, &#39;jfhdkfdhkfdnhk&#39;, &#39;37483ndhfd87fdn&#39;, None)</span>
            <span class="k">return</span> <span class="n">logged_in_user</span><span class="o">.</span><span class="n">_asdict</span><span class="p">(),</span> <span class="mi">200</span></div>
</div>

            <span class="c1"># return jsonify({&#39;message&#39;: &#39;Google User updated...&#39;})</span>



<div class="viewcode-block" id="AllUsers">
<a class="viewcode-back" href="../../views.html#flask_app.views.AllUsers">[docs]</a>
<span class="k">class</span> <span class="nc">AllUsers</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AllUsers class inheriting from Resource class of the flask_restful module used to get all the available users and users data from the tables ``users`` and ``user_data`` on the database.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AllUsers.get">
<a class="viewcode-back" href="../../views.html#flask_app.views.AllUsers.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The get method of class AllUsers will return all the users and users data stored in the database</span>
<span class="sd">        </span>
<span class="sd">        :return: list of users and users data with custom structure</span>
<span class="sd">        :rtype: [dict, dict]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allusers</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">allusers</span><span class="p">:</span>
            <span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                <span class="s1">&#39;fullname&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">fullname</span><span class="p">,</span>
                <span class="s1">&#39;google_id&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">google_id</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">google_id</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="c1"># &#39;username&#39; : user.user_data.username if user.user_data != None else None,</span>
                <span class="c1"># &#39;userage&#39; : user.user_data.userage if user.user_data != None else None,</span>
                <span class="c1"># &#39;usercity&#39; : user.user_data.usercity if user.user_data != None else None,</span>
                <span class="c1"># &#39;usertype&#39; : user.user_data.usertype if user.user_data != None else None</span>
            <span class="p">}</span>

        <span class="n">users_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">allusers</span><span class="p">:</span>
            <span class="n">users_data</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">username</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;userage&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">userage</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;usercity&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">usercity</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;usertype&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span><span class="o">.</span><span class="n">usertype</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">user_data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">([</span><span class="n">users</span><span class="p">,</span> <span class="n">users_data</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="SearchUser">
<a class="viewcode-back" href="../../views.html#flask_app.views.SearchUser">[docs]</a>
<span class="k">class</span> <span class="nc">SearchUser</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SearchUser class inheriting from Resource class of the flask_restful module needs username of string type from the ``user_data`` to be passed in the url route for performing actions like searching, deleting and updating a particular user.</span>
<span class="sd">    The table ``user_data`` should have the username of string type passed as a parameter on the url route to perform all the actions on the methods namely ``get, delete, put``.</span>
<span class="sd">    Otherwise the actions will not be performed. </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SearchUser.get">
<a class="viewcode-back" href="../../views.html#flask_app.views.SearchUser.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>        
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The get method of SearchUser class will search for the user and returns that user&#39;s details in a dictionary format if exist, otherwise it will abort the request with User Not found message.</span>

<span class="sd">        :param username: This is the name which is coming from the url route while calling api</span>
<span class="sd">        :type username: str</span>

<span class="sd">        :return: list of user and user data  </span>
<span class="sd">        :rtype: [dict, dict]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">userdata</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from users where id=&#39;</span><span class="si">{</span><span class="n">userdata</span><span class="p">[</span><span class="s1">&#39;users_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
            <span class="c1"># userdata = UserData.query.filter_by(username = username).first().__dict__</span>
            <span class="c1"># user = Users.query.filter_by(id = userdata[&#39;users_id&#39;]).first().__dict__</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User Not Found.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">([</span><span class="n">user</span><span class="p">,</span> <span class="n">userdata</span><span class="p">])</span></div>


<div class="viewcode-block" id="SearchUser.delete">
<a class="viewcode-back" href="../../views.html#flask_app.views.SearchUser.delete">[docs]</a>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The delete method of SearchUser class will delete the particular user and particular user&#39;s data if the username exist, otherwise abort the request.</span>
<span class="sd">        It will not delete when there is session id of currently LoggedIn user. Because we cannot delete when we are already LoggedIn.</span>

<span class="sd">        :param username: This is the name which is coming from the url route while calling api</span>
<span class="sd">        :type username: str</span>

<span class="sd">        :return: the user is deleted or not</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># user_delete = UserData.query.filter_by(username=username).first()</span>
        <span class="c1"># if user_delete:</span>
        <span class="c1">#     db.session.delete(user_delete)</span>
        <span class="c1">#     db.session.commit()</span>
        <span class="c1"># return &#39;User is deleted&#39;</span>
        <span class="c1"># or</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_user_id&quot;</span><span class="p">)</span>
        <span class="n">user_delete</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="c1"># user_delete = UserData.query.filter_by(username = username).first()</span>

        <span class="k">if</span> <span class="n">user_delete</span> <span class="ow">and</span> <span class="n">user_delete</span><span class="p">[</span><span class="s1">&#39;users_id&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="o">!=</span> <span class="n">user_delete</span><span class="p">[</span><span class="s1">&#39;users_id&#39;</span><span class="p">]:</span>
                <span class="c1"># because the index 1 is the username field.</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;DELETE from user_data where username=&#39;</span><span class="si">{</span><span class="n">user_delete</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># db.session.delete(user_delete)</span>
                <span class="k">if</span> <span class="n">user_delete</span><span class="o">.</span><span class="n">users_id</span><span class="p">:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;DELETE from users where id=&#39;</span><span class="si">{</span><span class="n">user_delete</span><span class="o">.</span><span class="n">users_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Can&#39;t delete yourself.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">user_delete</span><span class="p">:</span>  <span class="c1"># to delete the users without havings users_id</span>
            <span class="c1"># because the index 1 is the username field.</span>
            <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;DELETE from user_data where username=&#39;</span><span class="si">{</span><span class="n">user_delete</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># user = Users.query.filter_by(username = user_delete[&#39;username&#39;]).first().delete()</span>
            <span class="c1"># db.session.delete(user)</span>
            <span class="k">return</span> <span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;User without having the users_id is deleted successfully.&quot;</span><span class="p">}),</span> <span class="mi">200</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User not found to DELETE.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;User is deleted&#39;</span></div>


    <span class="c1"># @marshal_with(create_user_field )</span>
    <span class="c1"># # Instead of the above line we can use .asdict() function or dict() to return in object format.</span>
<div class="viewcode-block" id="SearchUser.put">
<a class="viewcode-back" href="../../views.html#flask_app.views.SearchUser.put">[docs]</a>
    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The put method of SearchUser class will get the username of string type, if any matching user exist then it can update that particular user&#39;s data otherwise it cannot perform action.</span>

<span class="sd">        :param username: This is the name which is coming from the url route while calling api</span>
<span class="sd">        :type username: str</span>

<span class="sd">        :return: list of updated user and updated user data  </span>
<span class="sd">        :rtype: [dict, dict]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">parsed_user</span> <span class="o">=</span> <span class="n">update_user_req</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">userdata</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="c1"># userdata = UserData.query.filter_by(username = username).first()</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">userdata</span><span class="o">.</span><span class="n">users_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span>
                <span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User is not there to update (or) No appropriate users found.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">user_exist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="n">email_exist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from users where email=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="c1"># user_exist = UserData.query.filter_by(username = parsed_user[&#39;username&#39;]).first()</span>
            <span class="c1"># email_exist = Users.query.filter_by(email = parsed_user[&#39;email&#39;]).first()</span>
            <span class="k">if</span> <span class="n">userdata</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user_exist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">userdata</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_exist</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]:</span>
                        <span class="n">abort</span><span class="p">(</span>
                            <span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Username already exist. It must be unique.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">email_exist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">!=</span> <span class="n">email_exist</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]:</span>
                        <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Email already exist. It must be unique.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># if user is not there, then...</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User is not there to update.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">google_id</span><span class="p">:</span>  <span class="c1"># We should not update google&#39;s data, so...</span>
                <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]:</span>
                    <span class="c1"># db.engine.execute(f&quot;&quot;&quot;Update users SET</span>
                    <span class="c1"># email=&#39;{parsed_user[&#39;email&#39;]}&#39;,</span>
                    <span class="c1"># fullname=&#39;{parsed_user[&#39;fullname&#39;]}&#39;</span>
                    <span class="c1"># where id = &#39;{user.id}&#39;</span>
                    <span class="c1"># &quot;&quot;&quot;)</span>

                    <span class="c1"># user = Users.query.filter_by(id = user.id).first()</span>
                    <span class="c1"># user.email = parsed_user[&#39;email&#39;]</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Update users SET email=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE id = &#39;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]:</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Update users SET fullname=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE id = &#39;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                    <span class="p">)</span>
                    <span class="c1"># user = Users.query.filter_by(id = user.id).first()</span>
                    <span class="c1"># user.fullname = parsed_user[&#39;fullname&#39;]</span>

                <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]:</span>
                    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">generate_password_hash</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                    <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Update users SET password=&#39;</span><span class="si">{</span><span class="n">hashed_password</span><span class="si">}</span><span class="s2">&#39; WHERE id = &#39;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="c1"># user = Users.query.filter_by(id = user.id).first()</span>
                    <span class="c1"># user.password = hashed_password</span>
                
                <span class="c1"># db.session.commit()</span>
            
            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">google_id</span> <span class="ow">and</span> <span class="p">(</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]):</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cannot update google&#39;s data.&quot;</span><span class="p">)</span>
            
            <span class="c1"># user_data = UserData.query.filter_by(username = username).first()</span>
            <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]:</span>
                <span class="c1"># db.engine.execute(f&quot;&quot;&quot;Update user_data SET</span>
                <span class="c1"># username=&#39;{parsed_user[&#39;username&#39;]}&#39;,</span>
                <span class="c1"># userage=&#39;{parsed_user[&#39;userage&#39;]}&#39;,</span>
                <span class="c1"># usercity=&#39;{parsed_user[&#39;usercity&#39;]}&#39;,</span>
                <span class="c1"># usertype=&#39;{parsed_user[&#39;usertype&#39;]}&#39;,</span>
                <span class="c1"># users_id = &#39;{user.id}&#39;</span>
                <span class="c1"># WHERE username=&#39;{username}&#39;</span>
                <span class="c1"># &quot;&quot;&quot;)</span>
                
                <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Update user_data SET username=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE username = &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># user_data.username = parsed_user[&#39;username&#39;]</span>
            <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;userage&#39;</span><span class="p">]:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Update user_data SET userage=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;userage&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE username = &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># user_data.userage = parsed_user[&#39;userage&#39;]</span>
            <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usercity&#39;</span><span class="p">]:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Update user_data SET usercity=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usercity&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE username = &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># user_data.usercity = parsed_user[&#39;usercity&#39;]</span>
            <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usertype&#39;</span><span class="p">]:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Update user_data SET usertype=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usertype&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; WHERE username = &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="c1"># user_data.usertype = parsed_user[&#39;usertype&#39;]</span>
            
            <span class="c1"># db.session.commit()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]:</span>
                <span class="n">updated_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
                <span class="c1"># updated_data = UserData.query.filter_by(username = username).first().__dict__</span>
            <span class="k">elif</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]:</span>
                <span class="n">updated_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
                <span class="c1"># updated_data = UserData.query.filter_by(username = parsed_user[&#39;username&#39;]).first().__dict__</span>
            
            <span class="n">updated_user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;select * from users where id=&#39;</span><span class="si">{</span><span class="n">updated_data</span><span class="p">[</span><span class="s1">&#39;users_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>
            <span class="c1"># updated_user = Users.query.filter_by(id = updated_data[&#39;users_id&#39;]).first().__dict__</span>
                
            <span class="c1"># db.session.commit()</span>
            <span class="k">return</span> <span class="p">([</span><span class="n">updated_user</span><span class="p">,</span> <span class="n">updated_data</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="CreateUser">
<a class="viewcode-back" href="../../views.html#flask_app.views.CreateUser">[docs]</a>
<span class="k">class</span> <span class="nc">CreateUser</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CreateUser class inheriting from Resource class of the flask_restful module used to create a particular user and to store all the data on the ``users`` and  table on the database and on the firebase for later authentication on the ``Login`` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The below line will help us to convert our python object to look like JSON</span>
    <span class="c1"># here the resource fields tells that the returned data&#39;s should be in the JSON format...</span>
    <span class="c1"># then @marshal_with actually injects that rule in our method.</span>
<div class="viewcode-block" id="CreateUser.post">
<a class="viewcode-back" href="../../views.html#flask_app.views.CreateUser.post">[docs]</a>
    <span class="nd">@marshal_with</span><span class="p">(</span><span class="n">create_user_field</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The post method of the CreateUser class is used to create a user and store it on the database ``users`` table if not exist and on the firebase for email and password login. </span>

<span class="sd">        :return: user details like id and email</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_user</span> <span class="o">=</span> <span class="n">create_user_req</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="c1"># email_exist = Users.query.filter_by(email=parsed_user[&quot;email&quot;]).first()</span>
        <span class="n">email_exist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from users where email=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="c1"># if the email already exists, then</span>
        <span class="k">if</span> <span class="n">email_exist</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Email already exist.&#39;</span><span class="p">)</span>

        <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">generate_password_hash</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1"># add user to firebase</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">register_firebase</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">create_user_with_email_and_password</span><span class="p">(</span>
                <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="n">hashed_password</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;User not created, Try to enter valid entries. PROBLEM CAUSED BY GOOGLE FIREBASE&#39;&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]:</span>
            <span class="n">create_user</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span>
                <span class="n">email</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="n">fullname</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">create_user</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;created_user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_user</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="n">create_user</span><span class="p">:</span>
            <span class="n">created_user</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span>
            <span class="n">created_user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from users where email=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">created_user</span></div>
</div>



<div class="viewcode-block" id="AddUserData">
<a class="viewcode-back" href="../../views.html#flask_app.views.AddUserData">[docs]</a>
<span class="k">class</span> <span class="nc">AddUserData</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    AddUserData class inheriting from Resource class of the flask_restful module used to add data for the created user on the ``CreateUser`` class using the created session id from the CreateUser class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AddUserData.post">
<a class="viewcode-back" href="../../views.html#flask_app.views.AddUserData.post">[docs]</a>
    <span class="nd">@marshal_with</span><span class="p">(</span><span class="n">add_user_data_field</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The post method of AddUserData is used to add user information to the current user and store it on the database.</span>
<span class="sd">        This method exactly add up the data to the recently created user or logged in user, otherwise it cannot perform any action and will abort.</span>

<span class="sd">        :return: all the data of the created user  </span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_user</span> <span class="o">=</span> <span class="n">add_user_data_req</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="n">user_exist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="c1"># user_exist = UserData.query.filter_by(username = parsed_user[&#39;username&#39;]).first()</span>

        <span class="n">created_user_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_user_id&quot;</span><span class="p">)</span>
        <span class="n">user_id_exist</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from user_data where users_id=&#39;</span><span class="si">{</span><span class="n">created_user_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="c1"># user_id_exist = UserData.query.filter_by(users_id = created_user_id).first()</span>

        <span class="c1"># if the username already exists, then</span>
        <span class="k">if</span> <span class="n">user_exist</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User already exist with the username.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">user_id_exist</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;User Data with current user id already exist. Cannot create it again. Try to update it.&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">created_user_id</span><span class="p">:</span>
            <span class="n">create_user_data</span> <span class="o">=</span> <span class="n">UserData</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">],</span> <span class="n">userage</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;userage&#39;</span><span class="p">],</span>
                                        <span class="n">usercity</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usercity&#39;</span><span class="p">],</span> <span class="n">usertype</span><span class="o">=</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;usertype&#39;</span><span class="p">],</span> <span class="n">users_id</span><span class="o">=</span><span class="n">created_user_id</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">create_user_data</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="n">created_user_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from user_data where username=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="c1"># created_user_data = UserData(username = parsed_user[&#39;username&#39;])</span>

            <span class="k">return</span> <span class="n">created_user_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;No Users are currently created or logged in to add data.&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Login">
<a class="viewcode-back" href="../../views.html#flask_app.views.Login">[docs]</a>
<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Login class inheriting from Resource class of the flask_restful module used to login the ``user created by normal method`` not by google authenticated method. It can only login the user with data stored on database and the firebase.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Login.post">
<a class="viewcode-back" href="../../views.html#flask_app.views.Login.post">[docs]</a>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The post method of Login class is used to login a particular user by verifying it on the database and the firebase for authentication.</span>

<span class="sd">        :return: all the data of the logged in user  </span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># instead we can use request.json[&#39;field_name&#39;] for individual fields.</span>
        <span class="n">parsed_user</span> <span class="o">=</span> <span class="n">user_login_req</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from users where email=&#39;</span><span class="si">{</span><span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="c1"># user = Users.query.filter_by(email = parsed_user[&#39;email&#39;]).first()</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Email Not found or Unauthorized User&#39;</span><span class="p">)</span>
            <span class="c1"># or</span>
            <span class="c1"># return jsonify({&quot;message&quot;: &#39;Unauthorized User&#39;}), 401</span>

        <span class="c1"># means...if not True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span> <span class="n">parsed_user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]):</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Unauthorized User, password not matching.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># here simply getting the current user details for using the email to verify because we are not using email for signin. But in firebase we are using email for verfitication. That&#39;s why</span>
                <span class="n">login_firebase</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">sign_in_with_email_and_password</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
                <span class="n">session</span><span class="p">[</span><span class="s1">&#39;created_user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">409</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;problem with Google firebase authentication.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="n">userdata</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;select * from user_data where users_id=&#39;</span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="c1"># userdata = UserData.query.filter_by(users_id = user.id).first()</span>
            <span class="k">if</span> <span class="n">userdata</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">([</span><span class="n">user</span><span class="o">.</span><span class="n">_asdict</span><span class="p">(),</span> <span class="n">userdata</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="Logout">
<a class="viewcode-back" href="../../views.html#flask_app.views.Logout">[docs]</a>
<span class="k">class</span> <span class="nc">Logout</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logout class inheriting from Resource class of the flask_restful module used to logout a particular user by using the available session id. If there is not session id then it will abort the request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Logout.post">
<a class="viewcode-back" href="../../views.html#flask_app.views.Logout.post">[docs]</a>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The post method of Logout class will logout if any users are currently logged in. Which is identified by using the available session id.</span>
<span class="sd">        It basically removes/pops the session id from the cookie so that the particular will get logged out.</span>
<span class="sd">        </span>
<span class="sd">        :return: logged out or not</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;created_user_id&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s1">&#39;No user found with the Session ID.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Successfully logged out&#39;</span><span class="p">},</span> <span class="mi">200</span></div>
</div>



<div class="viewcode-block" id="CurrentUser">
<a class="viewcode-back" href="../../views.html#flask_app.views.CurrentUser">[docs]</a>
<span class="k">class</span> <span class="nc">CurrentUser</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CurrentUser class inheriting from Resource class of the flask_restful module used to get all the data of a currently loggedin user, which is identified by using the session id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="CurrentUser.get">
<a class="viewcode-back" href="../../views.html#flask_app.views.CurrentUser.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This get method of CurrentUser class will return the currently logged in user data from both tables namely ``users`` and ``user_data`` by using the session id called ``created_user_id``, Otherwise will abort the request.</span>
<span class="sd">        </span>
<span class="sd">        :return: the currently logged in user data</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_user_id&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s1">&#39;Unauthorized User or No Logged in users.&#39;</span><span class="p">)</span>
            <span class="c1"># or</span>
            <span class="c1"># return make_response(jsonify({&#39;error&#39;:&quot;Unauthorized User or No Logged in users.&quot;}), 409)</span>

        <span class="c1"># user = Users.query.filter_by(id = user_id).first()</span>
        <span class="c1"># userdata = UserData.query.filter_by(id = user_id).first()</span>
        
        <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from users where id=&#39;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">userdata</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;select * from user_data where users_id=&#39;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">userdata</span> <span class="ow">and</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">([</span><span class="n">user</span><span class="o">.</span><span class="n">_asdict</span><span class="p">(),</span> <span class="n">userdata</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()])</span>
            <span class="c1"># return jsonify({&#39;error&#39;:&quot;Unauthorized User or No Logged in users.&quot;})</span>
            <span class="c1"># return jsonify({&#39;user_data&#39;: user.__dict__, &#39;userdata_data&#39;: userdata.__dict__})</span>
            <span class="c1"># return jsonify([user.__dict__, userdata.__dict__])</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">userdata</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">([</span><span class="n">user</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()])</span>
                <span class="c1"># return jsonify({&#39;error&#39;:&quot;Unauthorized User or No Logged in users.&quot;})</span>
                <span class="c1"># return jsonify({&#39;user_data&#39;: user.__dict__})</span>
                <span class="c1"># return jsonify([user.__dict__])</span>
            <span class="k">if</span> <span class="n">userdata</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">([</span><span class="n">userdata</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()])</span>
                <span class="c1"># return jsonify({&#39;error&#39;:&quot;Unauthorized User or No Logged in users.&quot;})</span>
                <span class="c1"># return jsonify({&#39;userdata_data&#39;: userdata.__dict__})</span>
                <span class="c1"># return jsonify([userdata.__dict__])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">({</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;no current users&quot;</span><span class="p">}),</span> <span class="mi">200</span></div>
</div>

            <span class="c1"># return jsonify({&quot;message&quot;: &quot;no current users&quot;})</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Vishnu Kumar S S
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>